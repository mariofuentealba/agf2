<?php
// @(#) $Id$  246059001
// +-----------------------------------------------------------------------+
// | Copyright (C) 2008, http://yoursite                                   |
// +-----------------------------------------------------------------------+
// | This file is free software; you can redistribute it and/or modify     |
// | it under the terms of the GNU General Public License as published by  |
// | the Free Software Foundation; either version 2 of the License, or     |
// | (at your option) any later version.                                   |
// | This file is distributed in the hope that it will be useful           |
// | but WITHOUT ANY WARRANTY; without even the implied warranty of        |
// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the          |
// | GNU General Public License for more details.                          |
// +-----------------------------------------------------------------------+
// | Author: pFa                                                           |
// +-----------------------------------------------------------------------+
//
$mysqli = new mysqli("localhost","agf","agf","agf");
$ind = '';
$mysqli->query("INSERT INTO tag_agf value (null, '" . $ind ."', '" . $ind ."', 'NO ESPECIFICA', 'MANUAL', 1)");



$tag_agf = $mysqli->insert_id;

$sql = "INSERT INTO formulas values (null, '" . $tag_agf . "', '-1', '-1', '-1', '-1', 1, 1, 1, 1, 1, 'C1', '1', '2', 'C.NN.1', 'no', 'no', 'no', 'no');";
			    $sql2 = str_replace("'", "''", $sql);
				$mysqli->query("INSERT INTO log values ('" . $sql2 . "');");
			    				     
	                    /*$result = mysql_query($sql)
	                    or die(mysql_error());*/
			    
			    $mysqli->query($sql);
	            $ultimo_id = $mysqli->insert_id;
			    
			    $sql = "INSERT INTO indices_financieros VALUES (null, '3', 4, '" . $ind ."', '..', '" . $ultimo_id . "', '..', '1000', '0', '..', 1);";
			    $sql2 = str_replace("'", "''", $sql);
				$mysqli->query("INSERT INTO log values ('" . $sql2 . "');");
			       				
			    $mysqli->query($sql);			    


$indice = $mysqli->insert_id;


$str = "";
$arr = explode("\n", $str);
//$emp = array(725, 726, 727, 728, 729, 730);//Ingresos Totales
$emp = array(731, 732, 727, 728, 729, 730);//Ingresos Retail, SSS, Venta Retail / M2, % Margen Retail,Ingresos Financieros, Cartera Bruta (Colocaciones), Cartera Repactada MM$,
//$emp = array(731, 732, 727, 729, 730);//% Ventas con Tarjeta Credito de cada  Tiendas,

$s = 0;
$per = array(13, 14, 15, 16, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 28, 29);//  Ingresos Totales, Ingresos Retail, Venta Retail / M2, % Margen Retail, % Ventas con Tarjeta Credito de cada  Tiendas, Cartera Bruta (Colocaciones), Cartera Repactada MM$,

//$per = array(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 28, 29); // SSS,

for($i = 0; $i < count($arr); $i++){
	$arr[$i] = trim($arr[$i]);
	$arr[$i] = explode(";", $arr[$i]);
	for($j = 0; $j < count($arr[$i]); $j++){
		$arr[$i][$j] = "INSERT INTO valores (`ID_VALOR`, `ID_TAG_AGF`, `ID_EMPRESA`, `ID_PERIODO`, `VALOR`, `DT_MODIFICACION`, `origen`) 
						VALUES (null, '" . $tag_agf . "', " . $emp[$i] . ", " . $per[$s++] . ", " . ($arr[$i][$j] == '' ? 0 : $arr[$i][$j]) . ", null, 1);";
		$mysqli->query($arr[$i][$j]);
	}
	$s = 0;
}

for($i = 0; $i < count($emp); $i++){
	$sql = "INSERT INTO `indice_empresa`(`id_indice`, `id_empresa`, `tipo`) VALUES (" . $indice . ", " . $emp[$i] . ", 0)";
	$mysqli->query($sql);
}	




for($i = 0; $i < count($emp); $i++){
	$sql = "SELECT count(*) FROM `formulario_item` WHERE `id_empresa` = " . $emp[$i];
	$result = $mysqli->query($sql);
	$data = 0;
	while($row = $result->fetch_array(MYSQLI_NUM)){
		$data = $row[0];
	}
	
	$mysqli->query("INSERT INTO log values ('" . print_r($result, true) . "');");
	$sql = "INSERT INTO `formulario_item`(`id_empresa`, `id_tag_agf`, `fecha_insert`, `nun_item`, `estado`) VALUES (" . $emp[$i] . "," . $tag_agf . ", 0, " . $data .",'A')";	
	$sql2 = str_replace("'", "''", $sql);
	$mysqli->query("INSERT INTO log values ('" . $sql2 . "');");
	
	$mysqli->query($sql);
}	
$sql = "INSERT INTO `masivo`(`id_indice`, `id_tag_agf`, `id_formula`) VALUES (" . $indice . "," . $tag_agf . "," . $ultimo_id . ")";
$mysqli->query($sql);	
$mysqli->close();
var_dump($arr);

/*Ingresos Totales
$str = "233542;254770;246159;313263;239524;298623;275302;374579;282887;323310;302521;395808;332573;343868;321947;419376;340662;366735
167280;177713;168046;232725;162751;206590;190009;256034;197796;227685;211603;276250;243087;268116;260445;338153;259031;283857
153558;163183;149899;204105;146943;185685;168268;230886;171694;194699;175379;240846;181959;196529;189933;262762;185161;201353
;;;;46561;60811;66874;68830;60297;71891;59426;83423;68002;72012;71332;95113;75063;91066
;;;;;;;;;;;104093;74686;85098;80213;111933;82991;97676
29510;35315;32630;48906;32223;45917;41370;64401;42968;54256;53014;77275;52444;62514;58831;80041;54081;66458";


Ingresos Retail
165782;188414;181978;250644;177937;236601;210552;304952;216893;251753;233394;322080;256038;268026;245713;345696;266908;294358
104275;122555;115632;174074;116357;158616;141854;205892;143612;165572;155966;225623;184480;211395;202714;287486;205394;228564
95992;114936;107196;167872;108052;149286;125177;187059;126819;150977;133239;200992;141120;158095;151565;223096;144691;161228
;;;;29087;38844;25735;48465;36898;42385;34647;55952;39534;43669;43253;65894;46643;62196
;;;;;;;;;;;85866;59358;70888;66588;96920;67327;80583
17174;21761;21147;33711;18537;30099;25990;45137;24900;34345;34041;54803;31761;40160;37194;56287;33146;44619


SSS
5.6;26.2;15.6;18.9;20.9;3.7;9.1;5.6;9.2;1.6;-0.5;-0.1;-0.6;4.7
11.1;30.8;22.4;15.4;17.9;-1.9;3.5;4.7;9.4;5.5;5.2;2.7;4.9;2.9
10.6;28.5;17.4;14.2;18.0;1.5;5.3;8.4;9.3;7.2;9.9;7.6;0.1;-3.5
;;;;;;;;10.1;8.9;15.9;16.3;15.9;21.4
;;;;;;;;;;;15.0;15.0;16.0
8.0;39.8;25.8;30.6;29.4;9.6;14.9;9.5;9.1;1.7;3.0;-0.2;3.9;7.0


Venta Retail / M2,
713832;792262;764175;1052520;747204;970817;863936;1268372;902112;1047104;967388;1299490;1054673;1069946;980873;1336591;1022668;1102047
432648;562959;531158;799612;534488;728606;646036;878045;612447;696773;656348;828315;764626;569092;543224;762178;550167;610571
412302;493667;460426;707693;455514;629340;527706;788582;534628;641037;565723;853397;599185;636578;593511;885154;574074;624402
;;;;;;;;645966;765633;625844;1010694;714135;788821;723473;1048548;742214;693342
0;0;0;0;0;0;0;0;0;0;0;534325;373086;443051;416175;600121;418963;501449
250972;318004;309031;492635;268428;440236;380144;633756;350537;483496;420624;629962;365095;461643;427552;647021;381011;482805


% Margen Retail
25.7;28.9;27.2;33.0;29.6;31.4;28.9;32.7;28.7;29.9;26.2;30.8;24.9;29.8;30.2;31.6;28.5;30.1
20.8;27.2;27.4;28.4;27.0;28.7;28.7;28.3;27.5;29.8;25.5;27.7;25.7;29.6;24.7;28.3;27.1;30.4
22.2;26.5;20.4;28.3;25.2;29.4;24.8;29.0;26.5;31.7;25.1;27.9;23.9;26.9;23.4;29.6;26.1;28.6
;;;;13.8;37.3;-7.0;24.3;18.4;25.9;15.2;16.8;20.5;20.0;19.5;18.2;20.0;21.9
;;;;;;;;;;;20.9;20.1;24.2;19.2;23.9;22.9;28.2
17.6;20.3;19.9;21.9;19.1;24.4;23.2;27.6;21.3;24.6;21.1;26.7;21.0;25.2;24.6;28.4;24.8;27.4


% Ventas con Tarjeta Credito de cada  Tiendas
60;62;62;62;59;60;61;61;58;60;60;60;57;58;58;58;56;56
52;55;55;54;50;56;55;55;51;56;53;54;47;50;50;51;45;47
;;;;;;;;;;;;;;;;;
;;;;;;;;;;;50;45;50;49;49;45;50
58;69;64;68;56;66;64;64;56;66;63;61;52;59;60;54;48;56


Ingresos Financieros
67760;66356;64180;62619;61587;62022;64750;69626;65994;71557;69127;73728;76535;75842;76234;73680;73754;72378
63005;55158;52414;58651;46394;47974;48155;50142;54184;62113;55637;50627;58608;56721;57731;50667;53637;55293
57566;48247;42703;36233;38891;36399;43091;43826;44875;43722;42140;39854;40839;38434;38368;38601;40470;40125
0;0;0;0;17474;21967;41139;20365;23400;29506;24779;27471;28468;28343;28079;29219;28420;28870
0;0;0;0;0;0;0;0;0;0;0;18227;15328;14210;13625;15013;15664;17093
12336;13554;11483;15195;13685;15819;15380;19264;18068;19911;18973;22472;20683;22354;21637;23754;20935;21839


Cartera Bruta (Colocaciones)
713593;687789;666680;741850;731807;767896;798759;888209;894885;922479;942105;1043718;1062622;1047342;998000;1014272;953839;935829
419306;383029;346281;362770;322724;311888;349107;387151;399047;415066;369834;446795;361963;414216;408115;447401;429526;412007
430649;379881;333699;360611;332716;347763;353838;392000;378977;381824;359549;385558;361356;353940;355968;391829;372069;375521
;;;;;176606;;155577;173109;176396;160671;175602;166641;160313;154703;172878;166563;164653
;;;;;;;;;;;118015;98889;94381;87281;102229;100669;110318
73610;72796;74154;90954;86061;91273;92404;111358;107921;113552;113792;131351;123438;124058;121007;131726;120447;118918


Cartera Repactada MM$
;;;;;;;64236;;;;39255;38664;37487;44155;59310;64643;67790
;;;;;;;46767;;;;35017;31022;32474;33151;34740;34857;36848
;;;;;;;65812;;;;52016;46610;45659;43084;41504;39795;38420
;;;;;;;21230;;;;21556;20072;20070;21075;21709;20954;20117
;;;;;;;;;;;42487;30715;23494;18085;17255;16268;16204
;;;;;;;19973;;;;21442;23154;26387;29497;28810;27858;27005
*/

		
